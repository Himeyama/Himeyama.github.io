---
layout: post
date: 1970-01-01
title: 山口県の新型コロナウイルス情報
description: 山口県の新型コロナウイルス情報
---


<div class="card mb-3">
    <canvas class="card-body" id="myChart"></canvas>
</div>


<div class="card" style="height:720px;">
    <div class="card-body container overflow-auto" style="font-size: .8em;">
        <table id="table"></table>
    </div>
</div>


<script src="/assets/js/chart.min.js"></script>
<script src="/assets/js/gunzip.min.js"></script>
<script>

function date2str(date){
    return `${date.getFullYear()}/${(date.getMonth() + 1)}/${date.getDate()}`
}

function sdate2str(str){
    return date2str(new Date(str))
}

function sdate2w(str){
    return (new Era(str)).getWareki()
}

let reqsc2 = new XMLHttpRequest
reqsc2.responseType = "arraybuffer"
reqsc2.open("GET", "https://himeyama.github.io/cov2-api/positive_persons.json.gz")
reqsc2.send()
reqsc2.addEventListener("load", (e) => {
    data = JSON.parse(new TextDecoder().decode(new Zlib.Gunzip(new Uint8Array(e.target.response)).decompress()))

    let table = document.getElementById("table")
    let html = "<tr><th>No</th><th>市町村町名</th><th>陽性確定日</th><th>性別</th><th>年代</th><th>公表日</th><th>備考</th></tr>"
    for(let d of data.slice().reverse()){
        html += `<tr><td>${d["No"]}</td><td>${d["市町村町名"]}</td><td>${sdate2w(d["陽性確定日"])}</td><td>${d["患者_性別"]}</td><td>${d["患者_年代"]}</td><td>${sdate2w(d["公表日"])}</td><td>${d["備考"] ? d["備考"] : ""}</td></tr>`    
    }
    table.innerHTML += html

    const first = new Date(data[0]["陽性確定日"])
    const last = new Date(data[data.length-1]["陽性確定日"])
    let t = []
    let dt = []
    for(let date = first; date <= last; date.setDate(date.getDate() + 1)){
        t = t.concat(new Date(date))
        dt = dt.concat(date2str(date))
    }
    let tmp = {}
    for(let d of data){
        if(!tmp[(new Date(d["陽性確定日"])).toString()]) tmp[(new Date(d["陽性確定日"])).toString()] = 0
        tmp[(new Date(d["陽性確定日"])).toString()]++
    }
    let i = 0
    let x = []
    for(let ti of t){
        a = tmp[ti.toString()]
        if(!a) x[i] = 0
        else x[i] = a
        i++
    }

    let ctx = document.getElementById('myChart').getContext('2d')

    let config = {
        type: "line",
        data: {
            labels: dt.slice(dt.length-30, dt.length),
            datasets: [{
                label: "陽性者数(1ヶ月)",
                fill: false,
                borderColor: "#f44336",
                data: x.slice(x.length-30, x.length)
            }],
        },
        options: {
            scales: {
                xAxes: [{
                    type: 'time',
                    time: {
                        unit: 'day'
                    }
                }]
            }
        }
    }
    myChart = new Chart(ctx, config)

})
</script>
